---
title: "Analysis"
site: workflowr::wflow_site
output:
  workflowr::wflow_html:
    toc: false
editor_options:
  chunk_output_type: console
---


This document contains a series of steps that the project members have performed to explore the Geo-PKO dataset. More information on the dataset can be found on its [homepage](https://www.pcr.uu.se/data/geo-pko/).

Load packages.
```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(readr)
library(ggthemes)
library(knitr)
library(kableExtra)
```
Import the dataset. 

```{r, warning=FALSE, message =FALSE}
GeoPKO <- read_csv("data/geopko.csv")
```

Now we can start with the actual fun stuff! Let's have a quick look at the first few rows of the dataset.
 
```{r}
kable(GeoPKO[1:5,]) %>% kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```

The dataset covers UN peacekeeping missions in Africa between 1994 and 2018. We can use the dataset to extract the number of active missions during this period. 

```{r}
NoMission <- GeoPKO %>% select(year, Mission) %>% distinct(year, Mission) %>% count(year)
Plot1 <- ggplot(NoMission, aes(x=(as.numeric(year)), y=n)) + geom_point() + geom_line(size=0.5) +
  scale_x_continuous("Year", breaks=seq(1994, 2018, 1))+theme_classic()+
  scale_y_continuous("Number of missions", breaks=seq(0,10,1)) +
  theme(panel.grid=element_blank(), 
        axis.text.x=element_text(angle=45, vjust=0.5)) 
Plot1

```

We want to have a quick snapshot of the deployment size in 2018, as well as the missions that were active in that year. We start by subsetting the main dataset to include entries for the year of 2018 and our variables of interests. GeoPKO reports deployment sizes according to the available maps published by the UN. Therefore, to obtain the numbers of troop deployment at the yearly level, we calculate the average number of troops per location over the months recorded.

```{r}
GeoPKO$No.troops <- as.numeric(GeoPKO$No.troops)
map2018df <- GeoPKO %>% filter(year==2018) %>% 
  select(Mission, month, location, latitude, longitude, No.troops, HQ)
map2018df1 <- map2018df %>% group_by(location, latitude, longitude, Mission, HQ) %>% 
  summarize(ave = mean(No.troops, na.rm=TRUE)) %>% ungroup() 
kable(map2018df1[1:5,], caption = "A preview of this dataframe")
```

Next, we obtain the geometric shapes from `rnaturalearth`, and filter for countries in Africa.
```{r, warning=FALSE, message=FALSE}
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)

world <- ne_countries(scale = "medium", returnclass = "sf")
Africa <- world %>% filter(region_un == "Africa")

```

Here it is again, disaggregated by troop size and country.

```{r}
p3 <- ggplot(data=Africa) + geom_sf() +
    geom_point(data=map2018df1, 
                aes(x=longitude, y=latitude, size=ave, color=country), alpha=.4)+
    geom_point(data=map2018df1 %>% filter(HQ==3), 
                aes(x=longitude, y=latitude), color="black", shape=16, size=2)+
    geom_label_repel(data=map2018df1 %>% filter(HQ==3), 
                aes(x=longitude, y=latitude, label=Mission))+
    labs(title="UN Peacekeeping Deployment in Africa - 2018 (approx.)")+
    scale_size(range = c(2, 16))+
    labs(size="Average number of troops (continuous scale)",col="Country")+
    theme(
    panel.grid=element_blank(),
    axis.title=element_blank(),
    axis.ticks=element_blank(),
    axis.text=element_blank(),
    panel.background=element_blank()
    )

p3